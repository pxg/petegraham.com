<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Showing UK postcode data on a map using Redash" />
<meta name="author" content="Pete Graham" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technique to display datapoints from a Postgres database on a Redash map" />
<meta property="og:description" content="Technique to display datapoints from a Postgres database on a Redash map" />
<link rel="canonical" href="https://petegraham.com/pr-preview/pr-11/redash-uk-postcode-map-for-postgres/" />
<meta property="og:url" content="https://petegraham.com/pr-preview/pr-11/redash-uk-postcode-map-for-postgres/" />
<meta property="og:site_name" content="Pete Graham - CTO" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-23T09:43:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Showing UK postcode data on a map using Redash" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pete Graham"},"dateModified":"2018-05-23T09:43:00+00:00","datePublished":"2018-05-23T09:43:00+00:00","description":"Technique to display datapoints from a Postgres database on a Redash map","headline":"Showing UK postcode data on a map using Redash","mainEntityOfPage":{"@type":"WebPage","@id":"https://petegraham.com/pr-preview/pr-11/redash-uk-postcode-map-for-postgres/"},"url":"https://petegraham.com/pr-preview/pr-11/redash-uk-postcode-map-for-postgres/"}</script>
<!-- End Jekyll SEO tag -->

  <title>Pete Graham - CTO - Showing UK postcode data on a map using Redash</title>
  <link rel="apple-touch-icon" href='/pr-preview/pr-11/assets/images/apple-touch-icon.png'>
  <link rel="icon" type="image/svg+xml" href='/pr-preview/pr-11/assets/images/favicon.svg'>
  <link rel="icon" href='/pr-preview/pr-11/assets/images/favicon.ico'>
  <link rel="manifest" href='/pr-preview/pr-11/assets/images/site.webmanifest'>
  <link rel="icon" type="image/png" sizes="192x192" href='/pr-preview/pr-11/assets/images/web-app-manifest-192x192.png'>
  <link rel="icon" type="image/png" sizes="512x512" href='/pr-preview/pr-11/assets/images/web-app-manifest-512x512.png'>
  <link rel="stylesheet" href='/pr-preview/pr-11/assets/css/style.css'>
  <link rel="alternate" type="application/rss+xml" title="My Blog" href='/pr-preview/pr-11/rss.xml'>
  <link rel="stylesheet" href='/pr-preview/pr-11/assets/css/highlight.css'>
</head>
<body>

  <nav class="main-nav">
  <div class="nav-content">
    <a class="brand" href='/pr-preview/pr-11/'>petegraham.com</a>
    <a href='/pr-preview/pr-11/blog/'>Articles</a>
    <a href='/pr-preview/pr-11/TIL/'>TIL </a>
    <a href='/pr-preview/pr-11/'>About</a>
  </div>
</nav>


  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>Showing UK postcode data on a map using Redash</h1>
    </header>
    <section id="post-body">
        <p>As many of my readers will know I’ve recently become a fan of the reporting software <a href="https://redash.io">https://redash.io</a>. A lesser known fact is I’m also a big fan of big bolts. Whenever I’m out and about and I see a cracking bolt I like to take a photo, then like any self respecting bolt enthusiast I log the postcode of where I saw the bolt to my Postgres database.</p>

<p><img src="/assets/images/posts/cracking-bolt.JPG" alt="Photo of a cracking bolt" /></p>

<p>Above a photo of a cracking bolt I saw at Canonbury overground station.</p>

<p>Now one day it struck me that it would be great to plot the location of all these big bolts on a map so people could to do a bolt-based tour.</p>

<p>In this post I’ll explain how to create a map with Redash that can take data with postcodes from a Postgres table. None of the techniques in this post are bolt specific. This post has been written using Redash 3.0.0 and Postgres 9.5.6.</p>

<h2 id="mapping-postcodes-to-longitude-and-latitude">Mapping postcodes to longitude and latitude</h2>
<p>The map functionality in Redash requires a latitude and longitude so you need to be able to map from a UK postcode to latitude and longitude coordinates. To do this download <a href="https://www.freemaptools.com/download/full-postcodes/ukpostcodes.zip">ukpostcodes.zip</a> from <a href="https://www.freemaptools.com/download-uk-postcode-lat-lng.htm">freemaptools.com</a> and unzip it, you now have a CSV file of the UK postcodes and their latitudes and longitudes.</p>

<p>Next login to your database using <code class="language-plaintext highlighter-rouge">psql</code> and create the table <code class="language-plaintext highlighter-rouge">location</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE location(
    id integer,
    postcode CHAR(10) NOT NULL,
    latitude decimal,
    longitude decimal
);
</code></pre></div></div>

<p>Next we populate the table with the postcode, latitude, longitude data from the CSV file we downloaded:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COPY location FROM 'ukpostcodes.csv' WITH (FORMAT csv);
</code></pre></div></div>
<p>For some locked down environments, like Heroku, you may need this alternative syntax to get round permission issues:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\copy location FROM 'ukpostcodes.csv' WITH CSV;
</code></pre></div></div>

<p>Our location table is now populated and we can map postcodes to latitude and longitude coordinates.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolts=# select * from location;
   id    |  postcode  |      latitude      |     longitude
---------+------------+--------------------+--------------------
       1 | AB10 1XG   | 57.144165160000000 | -2.114847768000000
       2 | AB10 6RN   | 57.137879760000000 | -2.121486688000000
       3 | AB10 7JB   | 57.124273770000000 | -2.127189644000000
       4 | AB11 5QN   | 57.142701090000000 | -2.093295000000000
       5 | AB11 6UL   | 57.137546630000000 | -2.112233000000000
       6 | AB11 8RQ   | 57.135977620000000 | -2.072114784000000
       7 | AB12 3FJ   | 57.098002900000000 | -2.077438000000000
       8 | AB12 4NA   | 57.064272750000000 | -2.130018015000000
       9 | AB12 5GL   | 57.081937920000000 | -2.246567389000000
      10 | AB12 9SP   | 57.148707080000000 | -2.097806027000000
      11 | AB14 0TQ   | 57.101556920000000 | -2.268485752000000
      12 | AB15 5HB   | 57.147428000000000 | -2.147266200000000
      13 | AB15 6NA   | 57.151797000000000 | -2.185398000000000
      14 | AB15 8BA   | 57.135624220000000 | -2.175239142000000
      15 | AB15 8UF   | 57.154005960000000 | -2.224401880000000
      16 | AB15 9SE   | 57.118647620000000 | -2.174250607000000
      17 | AB16 5ST   | 57.163465880000000 | -2.159333430000000
      18 | AB16 6SZ   | 57.158751170000000 | -2.165214861000000
--More--
</code></pre></div></div>

<p>Pete, I hear you cry, this article started off really strong but you haven’t mentioned bolts for a number of paragraphs. Well you’re in luck now we’re going to create our boltmania table and insert some values:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE boltmania(
    id integer,
    postcode CHAR(10) NOT NULL,
    rating CHAR(255) NOT NULL
);
INSERT INTO boltmania VALUES (1, 'N1 2PG', 'Helluva Bolt');
INSERT INTO boltmania VALUES (2, 'N1 2LW', 'Big boy bolt');
INSERT INTO boltmania VALUES (3, 'N1 4RA', 'Usain bolt');
INSERT INTO boltmania VALUES (4, 'N16 9EH', 'Probably the greatest bolt I''ve ever seen');
</code></pre></div></div>

<p>Now let’s write some SQL and make a map! Create a new query in Redash and enter the following:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT boltmania.postcode,
       latitude,
       longitude
FROM boltmania,
     location
WHERE boltmania.postcode = location.postcode;
</code></pre></div></div>

<p>Now save your query and run it, you should see output like the image below:</p>

<p><img src="/assets/images/posts/redash_bolts_1.png" alt="Screenshot of Redash table UI" /></p>

<p>One thing to note is the Redash table UI limits the number of decimal places to 2 which is misleading. The more accurate longitude and latitude is there if you download the dataset.</p>

<p>Now click the “+ NEW VISUALIZATION” button, which is outlined in red on the screenshot above, then select:</p>
<ul>
  <li>visualisation type: map</li>
  <li>Latitude Column Name: latitude</li>
  <li>Longitude Column Name: longitude
Then click save</li>
</ul>

<p><img src="/assets/images/posts/redash_bolts_2.png" alt="Screenshot of Redash Map UI" /></p>

<p>As you see we now have a cracking map showing you some of the best bolts in London. You luck lucky people!</p>

<h2 id="trade-offs">Trade-offs</h2>
<p>With all software development there are trade-offs with the design decisions you make. Here are those with the techniques in this article.</p>

<h3 id="storage-of-location-data">Storage of location data</h3>
<p>Saving the <code class="language-plaintext highlighter-rouge">location</code> table data to your database will bloat it, an alternative would be to use <a href="https://wiki.postgresql.org/wiki/Foreign_data_wrappers">Postgres Foreign Data Wrappers</a> and keep the location data in a separate database which you can still run a join on. Alternatively you could just populate the location table with the values you need, using a script to call an API such as <a href="https://postcodes.io/">https://postcodes.io/</a> just for the postcodes we want.</p>

<h3 id="map-interactions">Map interactions</h3>
<p>The Redash map UI show pins on the map for each of your items and groups them dependent on the zoom level. If you wanted different interaction you may need to use an API such as the Google Maps API to build custom custom behaviour.</p>

<p>If you enjoyed this and want to try it out Redash read my <a href="/running-redash-on-mac-os/">running redash on macOs</a> article.</p>

<p>Thanks to <a href="https://petegoodman.com/">Pete Goodman</a> for correcting the spelling in this article, and more importantly sending me this photo of a marvellous bolt.</p>

<p><img src="/assets/images/posts/goobolt.jpg" alt="Photos of Gooman's bolt" /></p>

        <p>
        If you'd like to contact me then you can email <a href="mailto:writing@petegraham.co.uk">writing@petegraham.co.uk</a>.
        </p>
    </section>
    <h2 class="headline">May 23, 2018</h2>
</article>
<footer id="post-meta" class="clearfix">
    <a href='/pr-preview/pr-11/'>
        <img class="avatar" src='/pr-preview/pr-11/assets/images/avatar.png' srcset='/pr-preview/pr-11/assets/images/avatar.png 1x, /pr-preview/pr-11/assets/images/avatar@2x.png 2x'>
        <div>
            <span class="dark">Pete Graham</span>
            <span>Bridging Technology Strategy & Business Scaling</span>
        </div>
    </a>

</footer>

<!-- Disqus comments -->


<!-- Archive post list -->
<!-- TODO: hide current post here -->





  </section>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src='/pr-preview/pr-11/assets/js/main.js'></script>
  <script src='/pr-preview/pr-11/assets/js/highlight.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1161798-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>



