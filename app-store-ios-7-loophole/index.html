<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="App Store iOS 7 loophole" />
<meta name="author" content="Pete Graham" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Apple approval process doesn’t find iOS 7 bug" />
<meta property="og:description" content="Apple approval process doesn’t find iOS 7 bug" />
<link rel="canonical" href="https://petegraham.com/app-store-ios-7-loophole/" />
<meta property="og:url" content="https://petegraham.com/app-store-ios-7-loophole/" />
<meta property="og:site_name" content="Pete Graham - CTO" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-08-24T12:09:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="App Store iOS 7 loophole" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pete Graham"},"dateModified":"2015-08-24T12:09:00+00:00","datePublished":"2015-08-24T12:09:00+00:00","description":"Apple approval process doesn’t find iOS 7 bug","headline":"App Store iOS 7 loophole","mainEntityOfPage":{"@type":"WebPage","@id":"https://petegraham.com/app-store-ios-7-loophole/"},"url":"https://petegraham.com/app-store-ios-7-loophole/"}</script>
<!-- End Jekyll SEO tag -->

  <title>Pete Graham - CTO - App Store iOS 7 loophole</title>
  <link rel="apple-touch-icon" href='/assets/images/apple-touch-icon.png'>
  <link rel="icon" type="image/svg+xml" href='/assets/images/favicon.svg'>
  <link rel="icon" href='/assets/images/favicon.ico'>
  <link rel="manifest" href='/assets/images/site.webmanifest'>
  <link rel="icon" type="image/png" sizes="192x192" href='/assets/images/web-app-manifest-192x192.png'>
  <link rel="icon" type="image/png" sizes="512x512" href='/assets/images/web-app-manifest-512x512.png'>
  <link rel="stylesheet" href='/assets/css/style.css'>
  <link rel="alternate" type="application/rss+xml" title="My Blog" href='/rss.xml'>
  <link rel="stylesheet" href='/assets/css/highlight.css'>
</head>
<body>

  <nav class="main-nav">
  <div class="nav-content">
    <a class="brand" href='/'>petegraham.com</a>
    <a href='/blog/'>Articles</a>
    <a href='/TIL/'>TIL </a>
    <a href='/'>About</a>
  </div>
</nav>


  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>App Store iOS 7 loophole</h1>
        
    </header>
    <section id="post-body">
        <p>When we first released <a href="https://itunes.apple.com/gb/app/warblr/id1013921979?ls=1&amp;mt=8">Warblr</a> we had a few angry customers complaining the app crashed as soon as they loaded it up. Of course we wanted to solve this problem as soon as possible, especially since Warlbr is a paid app.</p>

<p>From talking to the users with the issue we found many of them were using the iPhone 4. Users with newer iPhones experiencing the problem were using iOS 7. <a href="https://en.wikipedia.org/wiki/List_of_iOS_devices#iPhone">Our research</a> confirmed the newest operating system the iPhone 4 can support is iOS 7.</p>

<p>We could advise the people with newer models to upgrade to iOS 8 but this wouldn’t work for the iPhone 4 users. The confusing thing was the app had been approved by Apple App Store.</p>

<h2 id="emulating-ios-7">Emulating iOS 7</h2>

<p>The iPhone 4S is the oldest device you can emulate with Xcode 6.4, so this is what we’d tested the app with. Out of the box the iPhone 4S simulator runs with iOS 8.4. You can download an iOS 7.1 simulator by going into:</p>

<p><code class="language-plaintext highlighter-rouge">XCode -&gt; Preferences -&gt; Downloads</code></p>

<p><img src="/assets/images/posts/xcode_downloads.png" alt="Xcode preferences downloads" />
Now grab yourself a coffee, the download takes a while. Once it’s done open up the iOS simulator.</p>

<p><code class="language-plaintext highlighter-rouge">iOS Simulator -&gt; Hardware -&gt; Device -&gt; Manage Devices</code></p>

<p><img src="/assets/images/posts/xcode_simulators.png" alt="Xcode simulators" />
Click the plus icon in the bottom right hand corner of this screen to add a new simulated device running iOS 7. The new device will now appear in the list of devices that Xcode can run your app on.</p>

<p><img src="/assets/images/posts/xcode_run_on.png" alt="Xcoder run on" /></p>

<p>As far as I can tell you can only get emulators for older versions of iOS not older hardware such as the iPhone 4. Thankfully I was able to recreate the crashing bug with iOS 7, running on any device.</p>

<h2 id="fixing-ios-7-crash">Fixing iOS 7 crash</h2>

<p>It turns out the technique to access the users location changed in iOS 8. Below is the fixed code.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">Device</span> <span class="o">=</span> <span class="kt">UIDevice</span><span class="o">.</span><span class="nf">currentDevice</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">iosVersion</span> <span class="o">=</span> <span class="kt">NSString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="kt">Device</span><span class="o">.</span><span class="n">systemVersion</span><span class="p">)</span><span class="o">.</span><span class="n">doubleValue</span>

    <span class="n">locationManager</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="k">if</span> <span class="n">iosVersion</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="p">{</span>
        <span class="n">locationManager</span><span class="o">.</span><span class="nf">requestWhenInUseAuthorization</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">locationManager</span><span class="o">.</span><span class="n">desiredAccuracy</span> <span class="o">=</span> <span class="n">kCLLocationAccuracyBest</span>
    <span class="n">locationManager</span><span class="o">.</span><span class="nf">startUpdatingLocation</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure>

<p>The above code is used in a view controller that implements <code class="language-plaintext highlighter-rouge">CLLocationManagerDelegate</code>.</p>

<h2 id="conclusion">Conclusion</h2>
<p>When building apps it’s best to have physical versions of older Apple Devices running older versions of iOS.</p>

<p>I found it strange that Apple didn’t catch the iOS 7 bug during the approval process. The Apple App Store review  process is notoriously slow and painful, Warblr was rejected twice before it was approved. However no problems with iOS were mentioned.</p>

<p>I can only conclude that Apple don’t test the App on older devices or older versions of iOS. My theory is they don’t particularly care about users on old versions of their operating systems and users who use older hardware.</p>

        <p>
        If you'd like to contact me then you can email <a href="mailto:writing@petegraham.co.uk">writing@petegraham.co.uk</a>.
        </p>
    </section>
    <h2 class="headline">august 24, 2015</h2>
</article>
<footer id="post-meta" class="clearfix">
    <a href='/'>
        <img class="avatar" src='/assets/images/avatar.png' srcset='/assets/images/avatar.png 1x, /assets/images/avatar@2x.png 2x'>
        <div>
            <span class="dark">Pete Graham</span>
            <span>Bridging Technology Strategy & Business Scaling</span>
        </div>
    </a>

</footer>

<!-- Disqus comments -->


<!-- Archive post list -->
<!-- TODO: hide current post here -->





  </section>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src='/assets/js/main.js'></script>
  <script src='/assets/js/highlight.js'></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1161798-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>



